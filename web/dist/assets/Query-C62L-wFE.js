import{b as l,c as o,d as t,n as w,g as p,h as C,v as X,k as U,t as u,F as D,l as T,e as V,w as A,r as c,i as B,f as K}from"./index-DO8RJDxj.js";import{a as q}from"./index-Dnk_-Q5K.js";import{_ as N}from"./_plugin-vue_export-helper-DlAUqK2U.js";const E={class:"container",style:{"max-width":"600px","margin-top":"50px"}},F={class:"card"},L={key:0,class:"query-tabs",style:{display:"flex","margin-bottom":"20px"}},P={key:1,class:"form-group"},S={key:2,class:"form-group"},Q={key:3,class:"alert alert-danger",style:{"margin-bottom":"16px"}},O=["disabled"],R={key:5},j={style:{"margin-bottom":"16px",color:"var(--text-muted)"}},W=["onClick"],Z={style:{display:"flex","justify-content":"space-between","align-items":"center"}},G={style:{"font-weight":"600"}},H={style:{"font-size":"0.85rem",color:"var(--text-muted)"}},J={key:0,class:"status-badge status-used"},Y={key:1,class:"status-badge status-paid"},M={key:2,class:"status-badge status-pending"},ee={key:6},te={class:"order-info"},ae={class:"order-info-row"},se={class:"order-info-row"},le={class:"order-info-row"},oe={style:{color:"var(--primary)","font-weight":"600"}},ne={class:"order-info-row"},ie={key:0,class:"status-badge status-used"},re={key:1,class:"status-badge status-paid"},ue={key:2,class:"status-badge status-pending"},de={class:"order-info-row"},pe={key:0,style:{"margin-top":"20px"}},ve={class:"key-display"},ce={key:1,class:"alert alert-warning",style:{"margin-top":"20px"}},ye={key:2,class:"alert alert-warning",style:{"margin-top":"20px"}},me={__name:"Query",setup(be){const v=c("key"),y=c(""),m=c(""),b=c(!1),r=c(""),a=c(null),d=c([]);async function k(){var n,e;if(!y.value){r.value="请输入密钥";return}b.value=!0,r.value="";try{const{data:s}=await q.post("/api/key/query",{keyCode:y.value});a.value=s}catch(s){r.value=((e=(n=s.response)==null?void 0:n.data)==null?void 0:e.error)||"查询失败，请检查密钥是否正确"}finally{b.value=!1}}async function f(){var n,e;if(!m.value){r.value="请输入邮箱";return}b.value=!0,r.value="";try{const{data:s}=await q.post("/api/order/query-by-email",{email:m.value});s.length===0?r.value="未找到相关订单":s.length===1?a.value=s[0]:d.value=s}catch(s){r.value=((e=(n=s.response)==null?void 0:n.data)==null?void 0:e.error)||"查询失败，请检查邮箱是否正确"}finally{b.value=!1}}function I(n){a.value=n,d.value=[]}function g(){a.value=null,d.value=[],y.value="",m.value="",r.value=""}function $(){_(a.value.keyCode,"密钥已复制到剪贴板")}function z(){const s=`powershell -Command "Invoke-WebRequest -Uri '${`${window.location.origin}/api/download/${a.value.keyCode}`}' -OutFile 'cliproxyapi.zip'; Expand-Archive -Path 'cliproxyapi.zip' -DestinationPath '.' -Force; Remove-Item 'cliproxyapi.zip'; Start-Process cmd -ArgumentList '/k','cd /d cliproxyapi && start.bat'"`;_(s,`部署命令已复制！

请粘贴到 PowerShell 执行`)}function _(n,e){navigator.clipboard&&window.isSecureContext?navigator.clipboard.writeText(n).then(()=>{alert(e)}).catch(()=>{x(n,e)}):x(n,e)}function x(n,e){const s=document.createElement("textarea");s.value=n,s.style.position="fixed",s.style.left="-9999px",s.style.top="-9999px",document.body.appendChild(s),s.focus(),s.select();try{document.execCommand("copy"),alert(e)}catch{alert("复制失败，请手动复制")}document.body.removeChild(s)}function h(n){return n?new Date(n+"Z").toLocaleString("zh-CN"):"-"}return(n,e)=>{const s=B("router-link");return l(),o("div",E,[t("div",F,[e[14]||(e[14]=t("h2",{class:"card-title"},"订单查询",-1)),e[15]||(e[15]=t("p",{style:{color:"var(--text-muted)","margin-bottom":"20px"}}," 通过密钥或联系邮箱查询订单详情 ",-1)),!a.value&&d.value.length===0?(l(),o("div",L,[t("button",{class:w(["tab-btn",{active:v.value==="key"}]),onClick:e[0]||(e[0]=i=>{v.value="key",r.value=""})}," 密钥查询 ",2),t("button",{class:w(["tab-btn",{active:v.value==="email"}]),onClick:e[1]||(e[1]=i=>{v.value="email",r.value=""})}," 邮箱查询 ",2)])):p("",!0),!a.value&&d.value.length===0&&v.value==="key"?(l(),o("div",P,[e[5]||(e[5]=t("label",{class:"form-label"},"部署密钥",-1)),C(t("input",{type:"text",class:"input","onUpdate:modelValue":e[2]||(e[2]=i=>y.value=i),placeholder:"请输入16位密钥，如 XXXX-XXXX-XXXX-XXXX",onKeyup:U(k,["enter"])},null,544),[[X,y.value]])])):p("",!0),!a.value&&d.value.length===0&&v.value==="email"?(l(),o("div",S,[e[6]||(e[6]=t("label",{class:"form-label"},"联系邮箱",-1)),C(t("input",{type:"email",class:"input","onUpdate:modelValue":e[3]||(e[3]=i=>m.value=i),placeholder:"请输入下单时填写的联系邮箱",onKeyup:U(f,["enter"])},null,544),[[X,m.value]])])):p("",!0),r.value?(l(),o("div",Q,u(r.value),1)):p("",!0),!a.value&&d.value.length===0?(l(),o("button",{key:4,class:"btn btn-primary btn-block",onClick:e[4]||(e[4]=i=>v.value==="key"?k():f()),disabled:b.value||(v.value==="key"?!y.value:!m.value)},u(b.value?"查询中...":"查询订单"),9,O)):p("",!0),d.value.length>0&&!a.value?(l(),o("div",R,[t("p",j," 找到 "+u(d.value.length)+" 个订单，请选择要查看的订单： ",1),(l(!0),o(D,null,T(d.value,i=>(l(),o("div",{key:i.orderId,class:"order-item",onClick:ke=>I(i)},[t("div",Z,[t("div",null,[t("div",G,u(i.orderId),1),t("div",H,u(h(i.createdAt))+" · ¥"+u(i.amount),1)]),t("div",null,[i.isUsed?(l(),o("span",J,"已使用")):i.status==="paid"?(l(),o("span",Y,"已支付")):(l(),o("span",M,"待支付"))])])],8,W))),128)),t("button",{class:"btn btn-block",style:{"margin-top":"16px",background:"var(--bg-input)"},onClick:g}," 重新查询 ")])):p("",!0),a.value?(l(),o("div",ee,[t("div",te,[t("div",ae,[e[7]||(e[7]=t("span",null,"订单号",-1)),t("span",null,u(a.value.orderId),1)]),t("div",se,[e[8]||(e[8]=t("span",null,"订单类型",-1)),t("span",null,u(a.value.keyType==="builtin"?"内置账号":"自有账号"),1)]),t("div",le,[e[9]||(e[9]=t("span",null,"金额",-1)),t("span",oe,"¥"+u(a.value.amount),1)]),t("div",ne,[e[10]||(e[10]=t("span",null,"状态",-1)),t("span",null,[a.value.isUsed?(l(),o("span",ie,"已使用")):a.value.status==="paid"?(l(),o("span",re,"已支付")):(l(),o("span",ue,"待支付"))])]),t("div",de,[e[11]||(e[11]=t("span",null,"创建时间",-1)),t("span",null,u(h(a.value.createdAt)),1)])]),a.value.status==="paid"&&a.value.keyCode&&!a.value.isUsed?(l(),o("div",pe,[e[12]||(e[12]=t("p",{style:{"margin-bottom":"12px"}},"您的部署密钥：",-1)),t("div",ve,u(a.value.keyCode),1),t("button",{class:"btn btn-primary btn-block",onClick:$},"复制密钥"),t("button",{class:"btn btn-success btn-block",style:{"margin-top":"12px"},onClick:z},"下载部署脚本")])):p("",!0),a.value.isUsed?(l(),o("div",ce," 此密钥已被使用，无法再次使用 ")):p("",!0),a.value.status==="pending"?(l(),o("div",ye," 订单尚未支付，请完成支付后等待管理员确认 ")):p("",!0),t("button",{class:"btn btn-block",style:{"margin-top":"16px",background:"var(--bg-input)"},onClick:g}," 重新查询 ")])):p("",!0),V(s,{to:"/",class:"btn btn-block",style:{"margin-top":"16px",background:"var(--bg-input)","text-decoration":"none",color:"var(--text)"}},{default:A(()=>[...e[13]||(e[13]=[K(" 返回首页 ",-1)])]),_:1})])])}}},xe=N(me,[["__scopeId","data-v-eaa451ca"]]);export{xe as default};
